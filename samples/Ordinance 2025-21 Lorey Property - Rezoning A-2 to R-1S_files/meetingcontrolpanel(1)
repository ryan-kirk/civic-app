var CivicWeb=CivicWeb||{};CivicWeb.Document=CivicWeb.Document||{},function(n,t){var w=0,c=0,l=0,a="",b={},v=!1,it,i={},f,r={},y=!1,rt=!1,s={},ut=0,ft="",u,e=!1,o,k,et={0:"connecting",1:"connected",2:"reconnecting",4:"disconnected"},ot=function(n){console.log("MCP: "+et[n.newState])},d=function(n){var u,r,f;h();e&&(i.meetingStarted||i.meetingPaused)?(t(".mcp-item").removeClass("mcp-control-item-hilight"),t("#mcp-"+n).addClass("mcp-control-item-hilight")):(t(".mcp-item").hide(),t("#mcp-"+n).show());t("span.mcp-item-below-fold").remove();u=t("#mcp-"+n);r=u.offset();r&&(o?(f=t("div.word-margins").attr("data-scale"),t("html, body").animate({scrollTop:r.top-150},400)):u&&u.length&&r.top>t(window).scrollTop()+t(window).height()&&t("body").append(t("<span>",{"class":"fas fa-arrow-alt-circle-down mcp-item-below-fold bounce"}).on("click",function(){window.scrollTo(0,r.top-t(window).height()/2)})));CivicWeb&&CivicWeb.Document&&CivicWeb.Document.Voting&&k!==n&&CivicWeb.Document.Voting.hideVotingPopup();k=n},st=function(){var n=t(document.getElementById("start-meeting")).attr("data-state");switch(n){case"start":i.meetingStarted=!0;i.meetingPaused=!1;t(document.getElementById("start-meeting")).attr({disabled:"disabled"}).find("span.text").text(r.labelStarting);setTimeout(function(){t(document.getElementById("start-meeting")).removeAttr("disabled").find("span.text").text(r.labelPause);t(document.getElementById("start-meeting")).attr({"data-state":"pause"});t(document.getElementById("start-meeting")).find("span.icon").removeClass("fa-play").addClass("fa-pause");t(document.getElementById("stop-meeting")).show()},800);t(".mcp-item").removeClass("mcp-control-item-hilight").addClass("mcp-control-hover mcp-control-item").off("click").on("click",g);t(".mcp-item").show();break;case"pause":i.meetingStarted=!0;i.meetingPaused=!0;t(document.getElementById("start-meeting")).attr({"data-state":"resume"}).find("span.text").text(r.labelResume);t(document.getElementById("start-meeting")).find("span.icon").removeClass("fa-pause").addClass("fa-play");t(".mcp-item:not(.mcp-control-item-hilight)").hide();break;case"resume":i.meetingStarted=!0;i.meetingPaused=!1;t(document.getElementById("start-meeting")).attr({"data-state":"pause"}).find("span.text").text(r.labelPause);t(document.getElementById("start-meeting")).find("span.icon").removeClass("fa-play").addClass("fa-pause");i.hilightMeetingPosition(t(".mcp-item:visible").attr("data-id"));t(".mcp-item").show()}},ht=function(){i.meetingStarted=!1;i.clearMeetingPosition();t(document.getElementById("stop-meeting")).attr({disabled:"disabled"}).find("span.text").text(r.labelStopping);t(".mcp-item").hide();t(".mcp-item").removeClass("mcp-control-hover").addClass("mcp-control-item-hilight");setTimeout(function(){t(document.getElementById("stop-meeting")).removeAttr("disabled").find("span.text").text(r.labelStopMeeting);t(document.getElementById("stop-meeting")).hide();t(document.getElementById("start-meeting")).attr({"data-state":"start"}).find("span.text").text(r.labelStartMeeting);t(document.getElementById("start-meeting")).find("span.icon").removeClass("fa-pause").addClass("fa-play")},800)},g=function(){var n=t(this).attr("data-id");i.meetingStarted&&n>0&&i.meetingStarted&&!i.meetingPaused&&i.hilightMeetingPosition(n)},h=function(){var n=e&&i.meetingStarted?u.find(".mcp-control-item-hilight").attr("id"):u.find(".mcp-item:visible").attr("id");if(u.find(".mcp-item").remove(),nt(),e&&i.meetingStarted){t(".mcp-item").addClass("mcp-control-hover mcp-control-item").off("click").on("click",g);t(".mcp-item").show();n!=null&&t("#"+n).addClass("mcp-control-item-hilight")}else n!=null&&t("#"+n).show()},ct=function(){var n=e&&(i.meetingStarted||i.meetingPaused)?t(".mcp-item.mcp-control-item-hilight:visible"):t(".mcp-item:visible"),r=n.offset();n&&n.length&&r.top>t(window).scrollTop()&&r.top<t(window).scrollTop()+t(window).height()?t("span.mcp-item-below-fold").remove():n&&n.length&&r.top>t(window).scrollTop()+t(window).height()&&t("span.mcp-item-below-fold").length==0&&t("body").append(t("<span>",{"class":"fas fa-arrow-alt-circle-down mcp-item-below-fold bounce"}).on("click",function(){window.scrollTo(0,r.top-t(window).height()/2)}))},nt=function(){var i=t("div.word-margins").attr("data-scale"),n=u.find("a").filter(function(){return t(this).is("[name^=AgendaHeading]")||t(this).is("[name^=AgendaItem]")||t(this).is("[name^=Recommendation]")?t(this):null}).css({"vertical-align":"top"}),r=u.find("body");t.each(n,function(u,f){var e=t(f),c,s,h,a,l,v;(e.siblings(e.attr("name")).length===0||e.attr("name")==null)&&(c=e.attr("name"),c=c==null?e.attr("href"):c,s=e.offset()?e.offset().top:null,s=o&&s?s/i:s,h=n[u+1]&&t(n[u+1]).offset()?t(n[u+1]).offset().top:null,h=o&&h?h/i:h,a=h?h-s:r.offset().top+r.height()-s,a+=6,l=e.is("[name^=AgendaHeading]")?"AgendaHeading":e.is("[name^=AgendaItem]")?"AgendaItem":e.is("[name^=Recommendation]")?"Recommendation":"None",v=t("<div><\/div>").attr({id:"mcp-"+c.replace(l,""),"class":"mcp-item","data-id":c.replace(l,""),"data-type":l}).css({height:a+"px",display:"none"}),e.parent().css({position:"relative"}),e.before(v))});u.find('a[href]:not([href="#"])').css({"z-index":"150",position:"relative"})},lt=function(){if(!u.find("div#mcp-meeting-controls").length&&!o){var n=t("<div>",{id:"mcp-meeting-controls","class":"mcp-meeting-controls"+(v?" splitscreen":"")}).append(t("<button>",{id:"start-meeting",type:"button","class":"mcp-button","data-state":"start"}).off("click").on("click",st).append(t("<span>",{"class":"icon fas fa-play"})).append(t("<span>",{"class":"text"}).text(r.labelStartMeeting))).append(t("<button>",{id:"stop-meeting",type:"button","class":"mcp-button"}).css({display:"none"}).off("click").on("click",ht).append(t("<span>",{"class":"icon fas fa-stop"})).append(t("<span>",{"class":"text"}).text(r.labelStopMeeting)));y&&n.css({left:"15px"});u.find("body").append(n)}},at=function(){t(".mcp-item").hide();t(".mcp-item").removeClass("mcp-control-hover").addClass("mcp-control-item-hilight");t("span.mcp-item-below-fold").remove()},tt=function(){e&&lt();f.server.addUserToMCPViewers(i.meetingId,!1);ut=0},p=function(){t.ajax({url:a+"/api/meeting/"+l.toString()+"/live",contentType:"application/json",dataType:"json",async:!0,type:"GET",timeout:3e4,success:function(n){if(n){var t=parseInt(n.activeGuid);t>0&&d(t);CivicWeb&&CivicWeb.Document&&CivicWeb.Document.RequestToSpeak&&CivicWeb.Document.RequestToSpeak.setTimer(n.timerStatus)}setTimeout(p,5e3)},error:function(n){n.status!==403&&setTimeout(p,5e3)}})};n.meetingStarted=function(){return t(".mcp-item:visible").length};n.signalRConnected=function(){tt();setTimeout(function(){h()},100)};n.registerMethods=function(){f||!Function.prototype.bind||window.callPhantom||window._phantom||!t.connection||!t.connection.hub||(t.connection.hub.url=a+"/signalr",t.connection.hub.stateChanged(ot),f=t.connection.meetingControlPanelHub,f.client.updateMeetingPosition=function(n){d(n)},f.client.clearMeetingPosition=function(){at()},e&&(i.hilightMeetingPosition=function(n){f.server.updatePositionFromAgenda(i.meetingId,n)},i.clearMeetingPosition=function(){f.server.clearPosition(i.meetingId)}))};n.resizeAgendaDocument=function(){h()};n.load=function(n){c=n.documentId;l=n.meetingId;w=n.userId;userAdmin=n.userAdmin;a=n.url;y=n.agendaNotesApp;rt=n.agendaNotesAppRequest;ft=n.systemFont;it=new Date(n.meetingDateTime);e=n.meeetingControlUser;o=n.projector;r=n.localization;i.meetingId=l;i.userId=w;i.localization=r;i.meetingStarted=!1;i.meetingPaused=!1;y||(v=parent.$("iframe").length>0&&t(parent.$("iframe")[0]).attr("id")==="agenda-frame",b=parent.$);s=v?b:t;u=s(document.getElementById("agenda-frame")).length>0?s(document.getElementById("agenda-frame")).contents():s(document);c>0&&t.ajax({url:n.url+"/api/document/"+c.toString()+"/checkdocumentmeetinginrange",contentType:"application/json",dataType:"json",async:!0,type:"GET",timeout:3e4,success:function(n){n&&(e=n.userAdmin,e?(i.hilightMeetingPosition=function(n){f.server.updatePositionFromAgenda(i.meetingId,n)},i.clearMeetingPosition=function(){f.server.clearPosition(i.meetingId)}):u.find("div#mcp-meeting-controls").remove(),p())},error:function(){}});nt();t(window).on("resize",h)};n.signalRConnected=function(){tt()},function(){t(window).on("scroll",ct)}()}(window.CivicWeb.Document.MeetingControlPanel=window.CivicWeb.Document.MeetingControlPanel||{},window.jQuery)